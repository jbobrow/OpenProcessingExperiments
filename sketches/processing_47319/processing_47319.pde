
var res = [["589","Casquette army grise - par Coal sur Headict.com, The Headwear shop",["68b4bf15-2f7e-4e8e-b124-61db11017655","fc1a3fb4-653d-46c1-9833-639f05b2522e","947e90b0-4908-41e9-9b13-d822c7823411","6d15066e-2d79-4e5a-bf6c-4be0b53a1aeb","6b101fb9-d216-4726-9930-dc4b7edf5ea4","1814ac33-cef3-4295-857b-3efaa3986028","e8268786-0e17-426b-bd67-98b30ad53b6b","5a2f77a1-5b5e-4a1d-992d-69ebec129103"]],["502","Nippies en sequin or avec ponpon noir",["4039c560-41b5-46f1-961e-636a9f8ee130","6ff50206-7824-4f6a-947f-b18bb1b09598","cb7b7968-859f-4dc0-8d45-f3a0b6232ccc","d933d966-71f5-45d5-a9a9-8655fd3a5cb9","9aecf705-93c6-4e66-ba35-dfafaac7da9e","f9a10994-05af-4bfd-b734-aca530bfe011","f7bdf89e-3965-4997-b1fa-4428e5379888","d885b14e-4975-47f8-90f3-cfec5a32cd15"]],["502","Nippies en sequin or avec ponpon noir",["4039c560-41b5-46f1-961e-636a9f8ee130","6ff50206-7824-4f6a-947f-b18bb1b09598","cb7b7968-859f-4dc0-8d45-f3a0b6232ccc","d933d966-71f5-45d5-a9a9-8655fd3a5cb9","9aecf705-93c6-4e66-ba35-dfafaac7da9e","f9a10994-05af-4bfd-b734-aca530bfe011","f7bdf89e-3965-4997-b1fa-4428e5379888","d885b14e-4975-47f8-90f3-cfec5a32cd15"]],["502","Nippies en sequin or avec ponpon noir",["4039c560-41b5-46f1-961e-636a9f8ee130","6ff50206-7824-4f6a-947f-b18bb1b09598","cb7b7968-859f-4dc0-8d45-f3a0b6232ccc","d933d966-71f5-45d5-a9a9-8655fd3a5cb9","9aecf705-93c6-4e66-ba35-dfafaac7da9e","f9a10994-05af-4bfd-b734-aca530bfe011","f7bdf89e-3965-4997-b1fa-4428e5379888","d885b14e-4975-47f8-90f3-cfec5a32cd15"]],["574","casquette cubaine homme - par Goorin sur Headict.com, The Headwear shop",["71dd97d9-87f4-4b7c-9b33-9ce157359679","ece9c1d7-c4f5-4a23-8f12-bb0c11c735bf","e5b0fa3c-a4b6-459b-9f56-c5edac2ecc0e","5f4d9939-d9b0-4f04-bf34-583913b47626","5142dac0-131e-41c6-a2c9-a530f6d84333","c843c1bf-76f3-431d-8c66-e090d0f8b32b","001d18f8-1924-4f66-bb6c-4df4765c95df","1c77e6a0-038b-450d-ab7b-b99684ec4504"]],["574","casquette cubaine homme - par Goorin sur Headict.com, The Headwear shop",["71dd97d9-87f4-4b7c-9b33-9ce157359679","ece9c1d7-c4f5-4a23-8f12-bb0c11c735bf","e5b0fa3c-a4b6-459b-9f56-c5edac2ecc0e","5f4d9939-d9b0-4f04-bf34-583913b47626","5142dac0-131e-41c6-a2c9-a530f6d84333","c843c1bf-76f3-431d-8c66-e090d0f8b32b","001d18f8-1924-4f66-bb6c-4df4765c95df","1c77e6a0-038b-450d-ab7b-b99684ec4504"]],["589","Casquette army grise - par Coal sur Headict.com, The Headwear shop",["68b4bf15-2f7e-4e8e-b124-61db11017655","fc1a3fb4-653d-46c1-9833-639f05b2522e","947e90b0-4908-41e9-9b13-d822c7823411","6d15066e-2d79-4e5a-bf6c-4be0b53a1aeb","6b101fb9-d216-4726-9930-dc4b7edf5ea4","1814ac33-cef3-4295-857b-3efaa3986028","e8268786-0e17-426b-bd67-98b30ad53b6b","5a2f77a1-5b5e-4a1d-992d-69ebec129103"]],["563","Tanga en dentelle noire",["71dd97d9-87f4-4b7c-9b33-9ce157359679","68b4bf15-2f7e-4e8e-b124-61db11017655","fc1a3fb4-653d-46c1-9833-639f05b2522e","b5685b6b-012a-4bf5-a254-d7af9c8c3f18","1814ac33-cef3-4295-857b-3efaa3986028","e8f4260b-2831-48fd-826c-c3aa5b84124a"]],["574","casquette cubaine homme - par Goorin sur Headict.com, The Headwear shop",["71dd97d9-87f4-4b7c-9b33-9ce157359679","ece9c1d7-c4f5-4a23-8f12-bb0c11c735bf","e5b0fa3c-a4b6-459b-9f56-c5edac2ecc0e","5f4d9939-d9b0-4f04-bf34-583913b47626","5142dac0-131e-41c6-a2c9-a530f6d84333","c843c1bf-76f3-431d-8c66-e090d0f8b32b","001d18f8-1924-4f66-bb6c-4df4765c95df","1c77e6a0-038b-450d-ab7b-b99684ec4504"]],["563","Tanga en dentelle noire",["71dd97d9-87f4-4b7c-9b33-9ce157359679","68b4bf15-2f7e-4e8e-b124-61db11017655","fc1a3fb4-653d-46c1-9833-639f05b2522e","b5685b6b-012a-4bf5-a254-d7af9c8c3f18","1814ac33-cef3-4295-857b-3efaa3986028","e8f4260b-2831-48fd-826c-c3aa5b84124a"]]];



int screenWidth = 900;
int screenHeight = 450;
xBonus = [0, 0];
yBonus = [0, 0];
zBonus = [0, 0];
int xClicked = 0;
int yClicked = 0;
PFont fontA = loadFont ( "arial" );
bool changed = true;
int idChosen = -1;
double pi = 3.1415;

void setup()
{
    println("test");
    println("w: " + screenWidth);
    println("h: " + screenHeight);
    size(screenWidth,screenHeight);
    //res = {};
    
    //$('body').text(res);
    /*
    $.ajax({
        url:'http://en.wikipedia.org/wiki/SDTV',
        success: function(z) { 
            alert("ok");
        },
        error:function() {
            alert("ko");
        }
    });
    /*
    var json = $.get('http://en.wikipedia.org/wiki/SDTV'); // http://holowar.fr/quentin/nuit11/test2.php
    var data = eval("("+json+")");
    if(data) {
        alert(data);
    }
    
    /*
    $.ajax({
        url:'http://google.fr',
        // type:'GET',
        âˆ•/ dataType:'html',
        success: function(data) { 
            alert("ok");
        },
        error: function() {
            alert("error");
        }
    });*/
    
    println(res[0][1]);
        
    mydata = res;
    int sz = mydata.length;
    for ( int i = 0; i < sz; ++i )
    {
        //println(mydata.rows[i].name);
        //mydata[i].x = random() * screenWidth - screenWidth/2;
        //mydata[i].y = random() * screenHeight - screenHeight/2;
        double angle = i/sz;
        angle *= 2*pi;
        mydata[i].x = 0 + (screenWidth/2)*cos(angle);
        mydata[i].y = 0 + (screenHeight/2)*sin(angle);
    }
    
    //var elem = document.getElementById ("mycanvas");
    var elem = document;
    if (elem.addEventListener) {    // all browsers except IE before version 9
            // Internet Explorer, Opera, Google Chrome and Safari
        elem.addEventListener ("mousewheel", MouseScroll, false);
            // Firefox
        elem.addEventListener ("DOMMouseScroll", MouseScroll, false);
    }
    else {
        if (elem.attachEvent) { // IE before version 9
            elem.attachEvent ("onmousewheel", MouseScroll);
        }
    }
}

void MouseScroll ( event )
{
    changed = true;
    if ('wheelDelta' in event)
    {
        rolled = event.wheelDelta;
    }
    else
    {  // Firefox
        // The measurement units of the detail and wheelDelta properties are different.
        rolled = -40 * event.detail;
    }
    if ( rolled > 0 )
        rolled = 1;
    else
        rolled = -1;
    zBonus[1] += 0.07*rolled;
}

void draw()
{
    if ( !changed )
        return;
    double v = (mouseX - screenWidth/2) / (screenWidth/2); // [-1;1]
    double w = (mouseY - screenHeight/2) / (screenHeight/2);
    //xBonus -= 4*v*v*v;
    //yBonus -= 4*w*w*w;
    background ( 255 );
    textAlign ( CENTER );
    int size = 14*(1+zBonus[1]);
    int sizeChosen = 22*(1+zBonus[1]);
    fill ( 0 );
    textFont (fontA, size );
    int x = 0;
    int y = 0;
    for ( int i = 0; i < mydata.length; ++i )
    {
        x = screenWidth/2 + (xBonus[1] + mydata[i].x)*(1+zBonus[1]);
        // x - screenWidth/2 = (xBonus[1] + mydata.rows[i].x)*(1+zBonus[1])
        // (x - screenWidth/2)/(1+zBonus[1]) = xBonus[1] + mydata.rows[i].x
        // (x - screenWidth/2)/(1+zBonus[1]) - xBonus[1] = mydata.rows[i].x
        y = screenHeight/2 + (yBonus[1] + mydata[i].y)*(1+zBonus[1]);
        if ( x > -20 && x < screenWidth + 20 && y > -20 && y < screenHeight + 20 )
        {
            if ( idChosen == i )
            {
                fill ( 0, 255, 0 );
                //textFont (fontA, sizeChosen );
                textFont (fontA, size );
            }
            text ( mydata[i][1],
                x,
                y );
            if ( idChosen == i )
            {
                fill ( 0, 0, 255 );
                textFont (fontA, size );
                // disp info about this product
                int sz = mydata[i][2].length;
                for ( int j = 0; j < sz; ++j )
                {
                    double angle = j/sz;
                    angle += 0.2*(1/sz);
                    angle *= 2*pi;
                    text ( mydata[i][2][j],
                        x + 130*cos ( angle ),
                        y + 130*sin ( angle ) );
                }
                fill ( 0 );
            }
        }
    }
    changed = false;
}

void mouseDragged ()
{
    changed = true;
    xBonus[1] = xBonus[0] + (mouseX - xClicked)/(1+zBonus[1]);
    yBonus[1] = yBonus[0] + (mouseY - yClicked)/(1+zBonus[1]);
}

void mousePressed ()
{
    changed = true;
    xClicked = mouseX;
    yClicked = mouseY;
    xBonus[0] = xBonus[1];
    yBonus[0] = yBonus[1];
}

void mouseReleased ()
{
    changed = true;
    xClicked = mouseX;
    yClicked = mouseY;
}

void mouseClicked ()
{
    // (x - screenWidth/2)/(1+zBonus[1]) - xBonus[1] = mydata.rows[i].x
    xClicked = (mouseX - screenWidth/2)/(1+zBonus[1]) - xBonus[1];//(xBonus[1] + mouseX)*(1+zBonus[1]) - screenWidth/2; //mouseX;
    yClicked = (mouseY - screenHeight/2)/(1+zBonus[1]) - yBonus[1];//(yBonus[1] + mouseY)*(1+zBonus[1]) - screenHeight/2; //mouseY;
    
    println ( "xClicked: " + xClicked );
    println ( "yClicked: " + yClicked );
    // look for the element behind the mouse
    int clickRadiusW = 200;
    int clickRadiusH = 100;
    double nearestdist = 1000;
    int nearestid = -1;
    for ( int i = 0; i < mydata.length; ++i )
    {
        if ( mydata[i].x > xClicked - clickRadiusW
            && mydata[i].x < xClicked + clickRadiusW
            && mydata[i].y > yClicked - clickRadiusH
            && mydata[i].y < yClicked + clickRadiusH )
        {
            // TODO?: implement distance computation and select the nearest one. may be slow
            double d = sqrt((xClicked-mydata[i].x)*(xClicked-mydata[i].x) + 15*(yClicked-mydata[i].y)*(yClicked-mydata[i].y) );
            println("d: " + d);
            if ( d < nearestdist )
            {
                nearestdist = d;
                nearestid = i;
            }
        }
    }
    if ( nearestid != -1 )
    {
        println ( "found!: " + mydata[nearestid][1] );
        idChosen = nearestid;
    }
}

void keyPressed ()
{
    changed = true;
}

                
