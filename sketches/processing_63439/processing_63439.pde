
import wblut.geom.core.*;
import wblut.hemesh.creators.*;
import wblut.hemesh.tools.*;
import wblut.geom.grid.*;
import wblut.geom.nurbs.*;
import wblut.core.math.*;
import wblut.hemesh.subdividors.*;
import wblut.core.processing.*;
import wblut.hemesh.composite.*;
import wblut.core.random.*;
import wblut.hemesh.core.*;
import wblut.geom.frame.*;
import wblut.core.structures.*;
import wblut.hemesh.modifiers.*;
import wblut.hemesh.simplifiers.*;
import wblut.geom.triangulate.*;
import wblut.geom.tree.*;


/*
GridTyper.
Developed implementing the original concept found on
vormplus.be/blog/article/cloudswimmers-alphabet-the-process 

Developed with the great help from Frederik Vanhoutte.
W:blut - wblut.com - HE_Mesh lib for Processing
*/

import peasy.org.apache.commons.math.*;
import peasy.*;
import peasy.org.apache.commons.math.geometry.*;

PeasyCam cam;
HEC_Grid frontCreator;
HE_Mesh front, back, graphics, finale;
WB_Render render;
HEM_Extrude extruder;
HES_CatmullClark s;
HEM_Lattice lattice;
HE_Selection selection;

int gridSize = 16;
boolean inner = true;
boolean created = false;
int[][] faceIndex = new int[gridSize][gridSize];
char[] tempChar = new char[256];
ArrayList frontFaceKey = new ArrayList();
String bitCrafter = "/0/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011101100000000001111110000000000110111000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/1/0000000000000000000000000000000000000001100000000000000010000000000000001000000000000000100000000000000010000000000000001000000000000000100000000000000010000000000000001000000000000000100000000000000010000000000000000000000000000000000000000000000000000000/2/0000000000000000000000000000000000000111111000000000000001100000000000000110000000000000011000000000000001100000000000111110000000000110000000000000011000000000000001100000000000000110000000000000011111100000000000000000000000000000000000000000000000000000/3/0000000000000000000000000000000000000111111000000000000001100000000000000110000000000000011000000000000001100000000000011110000000000000011000000000000001100000000000000110000000000000011000000000011111100000000000000000000000000000000000000000000000000000/4/0000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001111110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000000000000000000000000000000000000000000/5/0000000000000000000000000000000000000111111000000000011000000000000001100000000000000110000000000000011000000000000001111100000000000000011000000000000001100000000000000110000000000000011000000000011111100000000000000000000000000000000000000000000000000000/6/0000000000000000000000000000000000000111111000000000011000000000000001100000000000000110000000000000011000000000000001111110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/7/0000000000000000000000000000000000000111111000000000000001100000000000000110000000000000011000000000000001100000000000001100000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000000000000000000000000000000000000000000000/8/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001111110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/9/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001111110000000000000011000000000000001100000000000000110000000000000011000000000011111100000000000000000000000000000000000000000000000000000/Q/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000001100000000000000000000000/W/0000000000000000000000000000000000001100001100000000110000110000000011000011000000001100001100000000110000110000000011000011000000001101101100000000110110110000000011011011000000001101101100000000111111110000000000000000000000000000000000000000000000000000/E/0000000000000000000000000000000000000111111000000000011000000000000001100000000000000110000000000000011000000000000001111100000000000110000000000000011000000000000001100000000000000110000000000000011111100000000000000000000000000000000000000000000000000000/R/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001111100000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/T/0000000000000000000000000000000000000111111000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000000000000000000000000000000000000000000000/Y/0000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000111100000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000000000000000000000000000000000000000000000/U/0000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/I/0000000000000000000000000000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000000000000000000000000000000000000000000000/O/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/P/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001111110000000000110000000000000011000000000000001100000000000000110000000000000011000000000000000000000000000000000000000000000000000000000/A/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001111110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/S/0000000000000000000000000000000000000111111000000000011000000000000001100000000000000110000000000000011000000000000001111110000000000000011000000000000001100000000000000110000000000000011000000000011111100000000000000000000000000000000000000000000000000000/D/0000000000000000000000000000000000000111110000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111000000000000000000000000000000000000000000000000000000/F/0000000000000000000000000000000000000111111000000000011000000000000001100000000000000110000000000000011000000000000001111100000000000110000000000000011000000000000001100000000000000110000000000000011000000000000000000000000000000000000000000000000000000000/G/0000000000000000000000000000000000000111111000000000011000000000000001100000000000000110000000000000011000000000000001101110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/H/0000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001111110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/J/0000000000000000000000000000000000000001111000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000011111100000000000000000000000000000000000000000000000000000/K/0000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001111100000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/L/0000000000000000000000000000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011111100000000000000000000000000000000000000000000000000000/Z/0000000000000000000000000000000000000111111000000000000001100000000000000110000000000000011000000000000011000000000000011000000000000011000000000000011000000000000001100000000000000110000000000000011111100000000000000000000000000000000000000000000000000000/X/0000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000001111000000000000011000000000000011110000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/C/0000000000000000000000000000000000000111111000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011111100000000000000000000000000000000000000000000000000000/V/0000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000110110000000000001111000000000000011100000000000000000000000000000000000000000000000000000/B/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001111100000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/N/0000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/M/0000000000000000000000000000000000001111111100000000110110110000000011011011000000001101101100000000110110110000000011000011000000001100001100000000110000110000000011000011000000001100001100000000110000110000000000000000000000000000000000000000000000000000/q/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000110000000000000011000000000000000000000/w/0000000000000000000000000000000000000000000000000000000000000000000000000000000000001101101100000000110110110000000011011011000000001101101100000000110110110000000011011011000000001101101100000000111111110000000000000000000000000000000000000000000000000000/e/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011111100000000001100000000000000110000000000000011111100000000000000000000000000000000000000000000000000000/r/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000011110000000000001000000000000000100000000000000010000000000000001000000000000000100000000000000010000000000000001000000000000000000000000000000000000000000000000000000000/t/0000000000000000000000000000000000000011000000000000001100000000000000110000000000000011110000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001111000000000000000000000000000000000000000000000000000000/y/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000111111000000000000001100000000000000110000000000111111000000000000000000000/u/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/i/0000000000000000000000000000000000000001100000000000000000000000000000000000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000000000000000000000000000000000000000000000/o/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/p/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000001100000000000000110000000000000000000000000/a/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000000001100000000000000110000000000111111000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/s/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000011000000000000001100000000000000111111000000000000001100000000000000110000000000000011000000000011111100000000000000000000000000000000000000000000000000000/d/0000000000000000000000000000000000000000011000000000000001100000000000000110000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/f/0000000000000000000000000000000000000011110000000000001000000000000000100000000000000011110000000000001000000000000000100000000000000010000000000000001000000000000000100000000000000010000000000000001000000000000000000000000000000000000000000000000000000000/g/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000111111000000000000001100000000000000110000000000111111000000000000000000000/h/0000000000000000000000000000000000000110000000000000011000000000000001100000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/j/0000000000000000000000000000000000000001100000000000000000000000000000000000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000000000000/k/0000000000000000000000000000000000000110000000000000011000000000000001100000000000000110011000000000011001100000000001100110000000000111110000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/l/0000000000000000000000000000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000000000000000000000000000000000000000000000/z/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000000001100000000000001100000000000001100000000000001100000000000001100000000000000110000000000000011111100000000000000000000000000000000000000000000000000000/x/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000110011000000000011001100000000000111100000000000001100000000000001111000000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/c/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000011000000000000001100000000000000110000000000000011000000000000001100000000000000110000000000000011111100000000000000000000000000000000000000000000000000000/v/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000110011000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000011011000000000000111100000000000000000000000000000000000000000000000000000/b/0000000000000000000000000000000000000110000000000000011000000000000001100000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011111100000000000000000000000000000000000000000000000000000/n/0000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000011001100000000001100110000000000110011000000000011001100000000001100110000000000110011000000000011001100000000000000000000000000000000000000000000000000000/m/0000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111100000000110110110000000011011011000000001101101100000000110110110000000011011011000000001101101100000000110110110000000000000000000000000000000000000000000000000000";
void setup() {
  size(650,550,P3D);
  cam = new PeasyCam(this, 100);
  cam.rotateY(radians(-35));
  char2Create("G");
  render=new WB_Render(this);
}

void draw() {
  background(240);
  lights();
  directionalLight(127, 127, 127, 1, 1, -1);
  directionalLight(127, 127, 127, -1, -1, 1);
  fill(100);
  noStroke();
  if(created)
    render.drawFaces(finale);
}



void keyPressed(){
  char2Create(Character.toString(key));
}





void createMesh(){ 
 

  frontCreator = new HEC_Grid();  
  frontCreator.setU(gridSize);
  frontCreator.setV(gridSize);
  frontCreator.setUSize(100);
  frontCreator.setVSize(100);

 

  front = new HE_Mesh(frontCreator);
  back = new HE_Mesh();
  finale = new HE_Mesh();
  graphics = new HE_Mesh();
  
  Iterator<HE_Face> fItr=front.fItr();
  HE_Face f;
  while (fItr.hasNext ()) {
    f=fItr.next();
    frontFaceKey.add(f.key());
  }
  
  int inOut = (inner)?0:1;
  int i = (Integer) frontFaceKey.get(0);
  for (int y = 0; y < gridSize; y++) {
    for (int x = 0; x < gridSize; x++) {
      if(faceIndex[x][y]==inOut){
          front.deleteFace(front.getFaceByKey(i));
      }
      i++;
    }
  }
  
  
  front.cleanUnusedElementsByFace(); //keep only mesh elements belonging to faces
  front.capHalfedges(); //restore the boundary halfedges
  back.set(front);
  back.flipAllFaces(); //after copying you need to flip all faces otherwise the back doesn't fit properly    
  
  extruder = new HEM_Extrude();
  extruder.setDistance(10.0);
  front.modify(extruder);  
   

  graphics.add(front);
  graphics.fuse(back); //turns the mesh in polygons and recreates the mesh form these polygons, a great way of solving problems like this..
  
  finale.set(graphics);
  finale.resolvePinchPoints();
  finale.pairHalfedges();

  s = new HES_CatmullClark().setKeepEdges(true).setKeepBoundary(true);
  finale.subdivide(s,1);

  selection=new HE_Selection(finale);

  Iterator<HE_Face> faceItr=finale.fItr();
  HE_Face face;
  while(faceItr.hasNext()){
   face=faceItr.next(); 
   if(random(100) < 25){
     selection.add(face);
   }
  }  
  lattice = new HEM_Lattice().setDepth(0.75).setWidth(1.0);
  finale.modifySelected(lattice, selection);

  finale.subdivide(s,1); 
  
  created = true;
  frontFaceKey.clear();
}



void char2Create(String c){
  
  if(bitCrafter.indexOf("/"+c+"/") != -1){
    int t = bitCrafter.indexOf("/"+c+"/");
    for(int i = 0; i<tempChar.length; i++){
      tempChar[i]=bitCrafter.charAt(t+3+i);      
    }
    
    int z = 0;  
    for (int y = 0; y < gridSize; y++) {
      for (int x = 0; x < gridSize; x++) { 
            char a  = tempChar[z];
            int b = Character.getNumericValue(a);
            faceIndex[x][y]=b;
            z++;
      }   
    }
  }


  if (key == ' ') {
    inner ^= true;
  }

  created = false;
  createMesh();
}



